<div class="sales-container">
  <div class="page-header">
    <h1>Sales</h1>
    <button class="btn btn-primary" (click)="openCreateForm()">Record New Sale</button>
  </div>

  @if (isLoading) {
    <div class="loading">Loading sales...</div>
  } @else if (error) {
    <div class="error-message">
      <p><strong>Error:</strong> {{ error }}</p>
      <button (click)="loadSales()" class="btn-retry">Retry</button>
    </div>
  } @else if (sales.length === 0) {
    <div class="empty-state">
      <p>No sales found.</p>
      <p class="empty-hint">Sales records will appear here once sales are recorded.</p>
      <button class="btn btn-primary" (click)="openCreateForm()">Record Your First Sale</button>
    </div>
  } @else {
    <div class="sales-table-container">
      <table class="sales-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Product</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total Amount</th>
            <th>Payment Method</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (sale of sales; track sale._id) {
            <tr>
              <td>{{ formatDate(sale.saleDate) }}</td>
              <td>{{ getProductName(sale) }}</td>
              <td>{{ sale.quantity }}</td>
              <td>{{ formatCurrency(sale.unitPrice) }}</td>
              <td>{{ formatCurrency(sale.totalAmount) }}</td>
              <td>
                <span class="payment-badge">{{ sale.paymentMethod }}</span>
              </td>
              <td class="actions-cell">
                <div class="action-buttons">
                  <button class="btn-icon btn-view" (click)="viewSale(sale)" title="View Details">
                    View
                  </button>
                  <button class="btn-icon btn-edit" (click)="openEditForm(sale)" title="Edit">
                    Edit
                  </button>
                  <button
                    class="btn-icon btn-delete"
                    (click)="deleteSale(sale)"
                    [disabled]="isDeleting && deletingSaleId === sale._id"
                    title="Delete"
                  >
                    @if (isDeleting && deletingSaleId === sale._id) {
                      Deleting...
                    } @else {
                      Delete
                    }
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <div class="pagination-info">
        Showing {{ sales.length }} of {{ total }} sales
      </div>
    </div>
  }
</div>

<app-sale-form
  [sale]="selectedSale"
  [isOpen]="showSaleForm"
  (close)="closeSaleForm()"
  (save)="onSaveSale($event)"
></app-sale-form>
